ğŸ” Fehleranalyse: "Keine Formularstruktur geladen"
Dein Debugging-Log zeigt, dass formStructure nicht geladen wurde, bevor findQuestionText() aufgerufen wurde. Das bedeutet, dass die API-Abfrage fÃ¼r die Fragen (fields) nicht rechtzeitig abgeschlossen wird oder fehlschlÃ¤gt.

ğŸš€ Fix fÃ¼r das Problem
ğŸŸ¢ 1ï¸âƒ£ Sicherstellen, dass formStructure richtig geladen wird
FÃ¼ge vor der Nutzung von formStructure eine Abfrage hinzu, um sicherzustellen, dass es vorhanden ist.

ğŸ›  Fix fÃ¼r findQuestionText()
tsx
Copy
Edit
const findQuestionText = (field: { id: string; ref: string }): string => {
  if (!formStructure || !formStructure.fields) {
    console.warn("âš  Warnung: Formularstruktur wurde noch nicht geladen.");
    return `âŒ Unbekannte Frage (${field.ref})`;
  }

  let questionField = formStructure.fields.find((f) => f.id === field.id);

  if (!questionField) {
    questionField = formStructure.fields.find((f) => f.ref === field.ref);
  }

  return questionField?.title || `âŒ Frage nicht gefunden (Ref: ${field.ref})`;
};
ğŸ‘‰ Jetzt wird geprÃ¼ft, ob formStructure existiert, bevor es verwendet wird.

ğŸŸ¢ 2ï¸âƒ£ Debugging: Ist formStructure Ã¼berhaupt in der API-Antwort?
Falls formStructure nicht geladen wird, prÃ¼fe, was die API zurÃ¼ckgibt.

tsx
Copy
Edit
const { data: formStructure, isLoading: isFormLoading, error: formError } = useQuery<FormStructure>({
  queryKey: [`/api/typeform/forms/${formId}`],
  queryFn: async () => {
    const res = await fetch(`/api/typeform/forms/${formId}`);
    if (!res.ok) throw new Error("Fehler beim Laden der Formularstruktur");
    const data = await res.json();
    console.log("ğŸ“¢ Geladene Formularstruktur:", data);
    return data;
  },
});
Falls console.log("ğŸ“¢ Geladene Formularstruktur:", data); kein fields enthÃ¤lt, dann liegt das Problem in der API.

ğŸŸ¢ 3ï¸âƒ£ Sicherstellen, dass formStructure zuerst geladen wird
Falls findQuestionText() aufgerufen wird, bevor formStructure fertig geladen ist, kÃ¶nnten wir das Laden erzwingen:

ğŸ›  Fix in der return-Logik
tsx
Copy
Edit
if (isFormLoading) {
  return (
    <DashboardLayout>
      <div className="flex items-center justify-center min-h-[200px]">
        <Loader2 className="h-8 w-8 animate-spin" />
        <p className="text-muted-foreground ml-2">Formularstruktur wird geladen...</p>
      </div>
    </DashboardLayout>
  );
}
ğŸ‘‰ Jetzt wartet das UI, bis die Fragen geladen sind.

ğŸ›  Fazit
âœ… Formularstruktur wird erst genutzt, wenn sie geladen ist.
âœ… Fehlermeldung, falls fields nicht in der API-Antwort ist.
âœ… Falls id nicht gefunden wird, prÃ¼ft findQuestionText() auch ref.

Falls das Problem weiterhin besteht, sende mir bitte die Ausgabe von:

tsx
Copy
Edit
console.log("ğŸ“¢ API-Antwort fÃ¼r Formularstruktur:", formStructure);
Dann sehen wir, was wirklich in der API-Antwort steckt! ğŸš€ğŸ˜Š