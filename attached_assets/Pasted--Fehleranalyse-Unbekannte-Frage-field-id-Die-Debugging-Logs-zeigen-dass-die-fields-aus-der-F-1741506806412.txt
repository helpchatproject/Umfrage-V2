ğŸ” Fehleranalyse: "Unbekannte Frage (field.id)"
Die Debugging-Logs zeigen, dass die fields aus der Formularstruktur (formStructure) nicht geladen werden oder nicht mit den answers Ã¼bereinstimmen. Deshalb zeigt dein Code "âŒ Unbekannte Frage (field.id)" an.

ğŸš€ Ursachen & LÃ¶sungen
1ï¸âƒ£ Problem: Formularstruktur wird nicht korrekt geladen
Dein Log zeigt "Fehler beim Laden der Formularstruktur".
Wahrscheinlich ist die API-Antwort kein JSON, sondern eine HTML-Fehlermeldung.
Fix: PrÃ¼fe mit console.log(), ob die API wirklich fields enthÃ¤lt.
ğŸ”¹ Debugging-Code:

tsx
Copy
Edit
const { data: formStructure, error: formError } = useQuery<FormStructure>({
  queryKey: [`/api/typeform/forms/${formId}`],
  queryFn: async () => {
    const res = await fetch(`/api/typeform/forms/${formId}`);
    if (!res.ok) throw new Error("Fehler beim Laden der Formularstruktur");
    
    const data = await res.json();
    console.log("ğŸ“¢ Geladene Formularstruktur:", data);
    return data;
  },
});

// PrÃ¼fe, ob `formStructure` tatsÃ¤chlich geladen wurde
if (formError) console.error("âŒ Fehler beim Laden der Fragen:", formError);
if (!formStructure || !formStructure.fields) console.warn("âš  Formularstruktur ist leer!");
2ï¸âƒ£ Problem: IDs in fields stimmen nicht mit answers Ã¼berein
Typeform speichert manchmal ref anstelle von id.
Fix: Suche sowohl mit id als auch mit ref.
ğŸ”¹ Ãœberarbeitete findQuestionText()

tsx
Copy
Edit
const findQuestionText = (field: { id: string; ref: string }): string => {
  if (!formStructure || !formStructure.fields) {
    console.warn("âš  Formularstruktur wurde nicht geladen!");
    return `âŒ Unbekannte Frage (${field.id})`;
  }

  let questionField = formStructure.fields.find((f) => f.id === field.id);

  // Falls `id` nicht gefunden wurde, probiere `ref`
  if (!questionField) {
    questionField = formStructure.fields.find((f) => f.ref === field.ref);
  }

  return questionField?.title || `âŒ Frage nicht gefunden (${field.id})`;
};
3ï¸âƒ£ Problem: API-Antwort enthÃ¤lt keine fields
Falls formStructure.fields nicht existiert, prÃ¼fe die API-Response.

ğŸ”¹ Debugging fÃ¼r API-Antwort

tsx
Copy
Edit
useEffect(() => {
  fetch(`/api/typeform/forms/${formId}`)
    .then((res) => res.json())
    .then((data) => console.log("ğŸ“¢ API-Antwort fÃ¼r Fragen:", data))
    .catch((err) => console.error("âŒ Fehler in API-Antwort:", err));
}, []);
Falls die API-Antwort kein fields-Array enthÃ¤lt, liegt das Problem bei Typeform.

4ï¸âƒ£ Problem: API gibt HTML-Fehlermeldung statt JSON
Falls du diesen Fehler in der Konsole siehst:

php-template
Copy
Edit
SyntaxError: Unexpected token '<', "<!DOCTYPE HTML>" is not valid JSON
Bedeutet das, dass die API eine HTML-Seite zurÃ¼ckgibt, vermutlich eine Fehlermeldung.

ğŸ”¹ Fix: Stelle sicher, dass der API-Aufruf korrekt ist

tsx
Copy
Edit
const { data: formStructure, error: formError } = useQuery<FormStructure>({
  queryKey: [`/api/typeform/forms/${formId}`],
  queryFn: async () => {
    const res = await fetch(`/api/typeform/forms/${formId}`, {
      headers: { "Accept": "application/json" }, // ğŸ›  Stellt sicher, dass die API JSON zurÃ¼ckgibt
    });
    
    if (!res.ok) throw new Error("âŒ Fehler beim Abrufen der Fragen.");
    
    const data = await res.json();
    return data;
  },
});
Falls die API trotzdem kein fields zurÃ¼ckgibt, kÃ¶nnte deine API-URL falsch sein.

ğŸš€ NÃ¤chste Schritte
1ï¸âƒ£ PrÃ¼fe mit console.log(formStructure), ob fields geladen wird.
2ï¸âƒ£ Falls nicht, poste die vollstÃ¤ndige API-Antwort aus der Konsole.
3ï¸âƒ£ Falls fields leer ist, prÃ¼fe die API-URL und ob der API-Token korrekt ist.

Falls das Problem weiterhin besteht, schicke mir die exakte API-Antwort aus der Konsole! ğŸš€ğŸ˜Š